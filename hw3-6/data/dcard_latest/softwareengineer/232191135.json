{"id":232191135,"title":"#請益 volatile問題","content":"這段程式碼的目的是用來返指標*ptr指向值的平方，但是，由於*ptr指向一個volatile型參數，編譯器將產生類似下面的程式碼︰\nint square(volatile int *ptr)\n{\n   int a，b;\n   a = *ptr;\n   b = *ptr;\n   return a * b;\n}\n\n \n由於*ptr的值可能被意想不到地該變，因此a和b可能是不同的。結果，這段程式碼可能返回不是你所期望的平方值！正確的程式碼如下︰\nlong square(volatile int *ptr)\n{\n   int a;\n   a = *ptr;\n   return a * a;\n}\n===============\n我的疑問有兩個\n第一 volatile int *ptr這個volatile修飾的其實是ptr提取的值\n而不是ptr本身\n上述說怕被意想不到地改變\n不是應該要改成 volatile int *volatile ptr是最安全的嗎\nptr不會被亂改 而且其提取的值也不會被亂改\n\n原文的第二種方法\n雖然利用一個變數先將*ptr存下來了\n但是如果在這個步驟前 ptr所指的位址就被改變了呢?\n\n不知有沒有人聽得懂我的疑問XD","excerpt":"這段程式碼的目的是用來返指標*ptr指向值的平方，但是，由於*ptr指向一個volatile型參數，編譯器將產生類似下面的程式碼︰，int square（volatile int *ptr），{，in","anonymousSchool":false,"anonymousDepartment":false,"pinned":false,"forumId":"a6dc1b6b-0aca-4004-86c8-3af6cdbfad23","replyId":null,"createdAt":"2019-09-29T06:04:47.725Z","updatedAt":"2019-09-29T06:04:47.725Z","commentCount":9,"likeCount":4,"tags":[],"topics":[],"supportedReactions":null,"withNickname":true,"reportReason":"","hiddenByAuthor":false,"meta":{"layout":"classic"},"forumName":"軟體工程師","forumAlias":"softwareengineer","school":"載入中…","department":"dirac_notation","replyTitle":null,"gender":"M","personaSubscriptable":true,"reactions":[{"id":"286f599c-f86a-4932-82f0-f5a06f1eca03","count":4}],"hidden":false,"customStyle":null,"isSuspiciousAccount":false,"layout":"classic","withImages":false,"withVideos":false,"media":[],"reportReasonText":"","mediaMeta":[],"postAvatar":""}