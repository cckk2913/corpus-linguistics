{"id":232474409,"title":"#分享 Python 的 Null Character 怎麼處理","content":"https://live.staticflickr.com/7185/6899803352_17e5b2a9bf.jpg\n\n因為美好的星期天就這樣被他毀了，所以一定要上來靠北一下 QQ\n\n故事是這樣的，小弟在清理自家搜尋引擎的 query。只是簡單的做些正規化、濾掉注音和數字，然後就插入自家的 Postgres9.6，然後就噴了以下的 Exception\n\n  File \"/usr/local/lib/python3.7/site-packages/airflow/hooks/dbapi_hook.py\", line 256, in insert_rows\n    cur.execute(sql, values)\nValueError: A string literal cannot contain NUL (0x00) characters.\n\n找了很久才找到我有一筆資料長得像這樣：string = \"\\x00Dcard\"，因為 \\x00 被 print 出來的時候效果等同於空字串所以肉眼無法分辨，只能一筆一筆看 raw data。\n\n至於 \\x00 是三小呢？根據 stackoverflow 的答案：\nIt's because null bytes (/x00), at least in C, are used to terminate a string. So, when you printf them, they are interpreted as the end of the string.\n\n剛好自家的搜尋引擎是用 Golang 做的，而 Golang 又是用 C 寫的，可能是因為這樣才會有這種詭異的字串。解決辦法也很簡單，單純 strip 掉就好：\nstring.strip(\"\\x00\")\n\n參考資料1: https://stackoverflow.com/questions/39014742/how-to-input-x00-memory-address-in-c\n參考資料2: https://blog.csdn.net/jason_cuijiahui/article/details/72511610","excerpt":"因為美好的星期天就這樣被他毀了，所以一定要上來靠北一下 QQ，故事是這樣的，小弟在清理自家搜尋引擎的 query。只是簡單的做些正規化、濾掉注音和數字，然後就插入自家的 Postgres9.6，然後就","anonymousSchool":false,"anonymousDepartment":false,"pinned":false,"forumId":"a6dc1b6b-0aca-4004-86c8-3af6cdbfad23","replyId":null,"createdAt":"2019-11-10T09:28:37.600Z","updatedAt":"2019-11-10T09:29:58.433Z","commentCount":4,"likeCount":8,"tags":[],"topics":["python","字串處理","空字串","nullcharacter"],"supportedReactions":null,"withNickname":true,"reportReason":"","hiddenByAuthor":false,"meta":{"layout":"classic"},"forumName":"軟體工程師","forumAlias":"softwareengineer","school":"搜尋工程師 小david","department":"ggggghgggg","replyTitle":null,"gender":"M","personaSubscriptable":true,"reactions":[{"id":"286f599c-f86a-4932-82f0-f5a06f1eca03","count":7},{"id":"aa0d425f-d530-4478-9a77-fe3aedc79eea","count":1}],"hidden":false,"customStyle":null,"isSuspiciousAccount":false,"layout":"classic","withImages":true,"withVideos":false,"media":[{"url":"https://live.staticflickr.com/7185/6899803352_17e5b2a9bf.jpg"}],"reportReasonText":"","mediaMeta":[{"id":"d1b2d47d-5485-478f-9d27-07b27ba5cae3","url":"https://live.staticflickr.com/7185/6899803352_17e5b2a9bf.jpg","normalizedUrl":"https://live.staticflickr.com/7185/6899803352_17e5b2a9bf.jpg","thumbnail":"https://live.staticflickr.com/7185/6899803352_17e5b2a9bf.jpg","type":"image/thumbnail","tags":["ANNOTATED"],"createdAt":"2019-11-10T09:28:37.600Z","updatedAt":"2019-11-10T09:29:58.433Z"},{"id":"d1b2d47d-5485-478f-9d27-07b27ba5cae3","url":"https://live.staticflickr.com/7185/6899803352_17e5b2a9bf.jpg","normalizedUrl":"","thumbnail":"https://live.staticflickr.com/7185/6899803352_17e5b2a9bf.jpg","type":"image/jpeg","tags":["ANNOTATED"],"createdAt":"2019-11-10T09:28:37.600Z","updatedAt":"2019-11-10T09:29:58.433Z"}],"postAvatar":""}